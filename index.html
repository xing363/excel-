<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel数据管理工具</title>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary: #3498db;
      --secondary: #2c3e50;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #34495e;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--secondary);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    header {
      background: var(--secondary);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
    }

    .logo i {
      font-size: 28px;
      margin-right: 12px;
      color: var(--primary);
    }

    .logo h1 {
      font-weight: 600;
    }

    .upload-area {
      background: var(--light);
      padding: 30px 20px;
      text-align: center;
      border-bottom: 2px dashed #bdc3c7;
      transition: all 0.3s;
    }

    .upload-area.active {
      background: rgba(52, 152, 219, 0.1);
    }

    .file-input {
      display: none;
    }

    .file-label {
      display: inline-block;
      padding: 12px 25px;
      background: var(--primary);
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3);
    }

    .file-label:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }

    .controls {
      padding: 20px;
      background: white;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      border-bottom: 1px solid #eee;
    }

    .search-box {
      flex-grow: 1;
      display: flex;
      max-width: 500px;
    }

    .search-box input {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px 0 0 6px;
      flex-grow: 1;
      font-size: 16px;
      outline: none;
      transition: border 0.3s;
    }

    .search-box input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .search-box button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      transition: all 0.2s;
    }

    .search-box button:hover {
      background: #2980b9;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 12px 18px;
      border-radius: 6px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn i {
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #27ae60;
      box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background: #e67e22;
      box-shadow: 0 4px 8px rgba(243, 156, 18, 0.3);
    }

    .btn-light {
      background: var(--light);
      color: var(--dark);
    }

    .btn-light:hover {
      background: #d5dbdb;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
      display: block;
    }

    .data-table th {
      background: var(--secondary);
      color: white;
      padding: 15px 10px;
      text-align: left;
      position: sticky;
      top: 0;
    }

    .data-table td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
    }

    .data-table tr:hover {
      background: #f8f9fa;
    }

    .action-cell {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      background: transparent;
      border: 1px solid;
    }

    .edit-btn {
      color: var(--warning);
      border-color: var(--warning);
    }

    .edit-btn:hover {
      background: rgba(243, 156, 18, 0.1);
    }

    .delete-btn {
      color: var(--danger);
      border-color: var(--danger);
    }

    .delete-btn:hover {
      background: rgba(231, 76, 60, 0.1);
    }

    .no-data {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
    }

    .no-data i {
      font-size: 64px;
      margin-bottom: 20px;
      color: #bdc3c7;
    }

    .form-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .form-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 600px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .form-header {
      background: var(--secondary);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
    }

    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }

    .form-body {
      padding: 30px;
    }

    .form-row {
      margin-bottom: 20px;
    }

    .form-row label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }

    .form-row input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border 0.3s;
    }

    .form-row input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      outline: none;
    }

    .form-footer {
      padding: 20px;
      background: var(--light);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .pagination {
      display: flex;
      justify-content: center;
      padding: 20px;
      gap: 10px;
      background: white;
    }

    .pagination button {
      padding: 8px 15px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .pagination button.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #7f8c8d;
      font-size: 14px;
      background: white;
      border-top: 1px solid #eee;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        max-width: 100%;
      }

      .action-buttons {
        flex-wrap: wrap;
      }

      .btn {
        flex-grow: 1;
        justify-content: center;
      }

      .logo h1 {
        font-size: 24px;
      }
    }

    @media (max-width: 480px) {
      .action-cell {
        flex-direction: column;
      }

      .form-body {
        padding: 20px;
      }

      .container {
        border-radius: 8px;
      }
    }

    .info-card {
      background: #e1f5fe;
      border-left: 4px solid var(--primary);
      padding: 15px;
      margin: 20px;
      border-radius: 0 8px 8px 0;
    }
  </style>
</head>
<body>
<div id="app">
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-file-excel"></i>
        <h1>Excel数据管理工具</h1>
      </div>
      <div class="file-info" v-if="excelData.length">
        <p>{{ fileName }} (共 {{ excelData.length }} 行数据)</p>
      </div>
    </header>

    <main>
      <div class="upload-area" :class="{ active: isDragging }"
           @dragover.prevent="handleDragOver"
           @dragleave="handleDragLeave"
           @drop.prevent="handleFileDrop">
        <h2 v-if="!excelData.length">请上传Excel文件</h2>
        <p class="info-card" v-if="!excelData.length">支持.xlsx和.xls格式，文件解析后可在网页上查看和编辑数据</p>

        <div v-if="excelData.length">
          <div class="info-card">
            数据已加载完成，可进行搜索、编辑和导出操作
          </div>
        </div>

        <input type="file" id="file-input" class="file-input"
               accept=".xlsx, .xls"
               @change="handleFileUpload" ref="fileInput">
        <label for="file-input" class="file-label">
          <i class="fas fa-upload"></i> 选择Excel文件
        </label>
        <p style="margin-top: 15px; color: #7f8c8d;">或拖拽文件到此处</p>
      </div>

      <div class="controls" v-if="excelData.length">
        <div class="search-box">
          <input type="text" v-model="searchTerm" placeholder="输入关键词搜索..."
                 @keyup.enter="searchData">
          <button @click="searchData">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <div class="action-buttons">
          <button class="btn btn-success" @click="openAddModal">
            <i class="fas fa-plus-circle"></i> 添加数据
          </button>
          <button class="btn btn-warning" @click="exportExcel">
            <i class="fas fa-file-export"></i> 导出Excel
          </button>
          <button class="btn btn-light" @click="clearData">
            <i class="fas fa-trash-alt"></i> 清除数据
          </button>
        </div>
      </div>

      <div class="table-container" v-if="excelData.length">
        <table class="data-table">
          <thead>
          <tr>
            <th v-for="(header, index) in tableHeaders" :key="index">{{ header }}</th>
            <th>操作</th>
          </tr>
          </thead>
          <tbody>
          <tr v-for="(row, rowIndex) in paginatedData" :key="rowIndex">
            <td v-for="(value, colIndex) in row" :key="colIndex">
              {{ value }}
            </td>
            <td class="action-cell">
              <button class="action-btn edit-btn"
                      @click="openEditModal(rowIndex + (currentPage - 1) * pageSize)">
                <i class="fas fa-edit"></i> 编辑
              </button>
              <button class="action-btn delete-btn"
                      @click="deleteRow(rowIndex + (currentPage - 1) * pageSize)">
                <i class="fas fa-trash"></i> 删除
              </button>
            </td>
          </tr>
          </tbody>
        </table>

        <div class="pagination" v-if="totalPages > 1">
          <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button v-for="page in visiblePages" :key="page"
                  @click="changePage(page)"
                  :class="{ active: currentPage === page }">
            {{ page }}
          </button>
          <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <div class="no-data" v-else>
        <i class="fas fa-database"></i>
        <h3>暂无数据</h3>
        <p>请上传Excel文件查看数据</p>
      </div>
    </main>

    <footer>
      <p>Excel数据管理工具 &copy; 2023 - 所有操作均在浏览器中完成，数据不会发送到服务器</p>
    </footer>
  </div>

  <!-- 添加/编辑模态框 -->
  <div class="form-modal" v-if="showModal">
    <div class="form-content">
      <div class="form-header">
        <h3>{{ modalMode === 'add' ? '添加新数据' : '编辑数据' }}</h3>
        <button class="close-btn" @click="closeModal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="form-body">
        <div class="form-row" v-for="(value, key, index) in currentRow" :key="index">
          <label>{{ tableHeaders[index] }}</label>
          <input type="text" v-model="currentRow[key]">
        </div>
      </div>

      <div class="form-footer">
        <button class="btn btn-light" @click="closeModal">取消</button>
        <button class="btn btn-primary" @click="saveRow">
          {{ modalMode === 'add' ? '添加数据' : '保存修改' }}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  new Vue({
    el: '#app',
    data: {
      excelData: [],
      tableHeaders: [],
      fileName: '',
      searchTerm: '',
      currentPage: 1,
      pageSize: 10,
      showModal: false,
      modalMode: 'add', // 'add' or 'edit'
      currentRow: {},
      currentIndex: -1,
      isDragging: false
    },
    computed: {
      filteredData() {
        if (!this.searchTerm) return this.excelData;

        const term = this.searchTerm.toLowerCase();
        return this.excelData.filter(row => {
          return Object.values(row).some(value =>
                  value.toString().toLowerCase().includes(term)
          );
        });
      },

      totalPages() {
        return Math.ceil(this.filteredData.length / this.pageSize);
      },

      visiblePages() {
        const pages = [];
        let startPage = Math.max(1, this.currentPage - 2);
        let endPage = Math.min(this.totalPages, startPage + 4);

        if (endPage - startPage < 4) {
          startPage = Math.max(1, endPage - 4);
        }

        for (let i = startPage; i <= endPage; i++) {
          pages.push(i);
        }

        return pages;
      },

      paginatedData() {
        const start = (this.currentPage - 1) * this.pageSize;
        const end = start + this.pageSize;
        return this.filteredData.slice(start, end);
      }
    },
    methods: {
      // Excel文件处理
      handleFileUpload(e) {
        const file = e.target.files[0];
        this.processExcelFile(file);
        this.$refs.fileInput.value = null; // 重置输入以便再次上传相同文件
      },

      handleFileDrop(e) {
        this.isDragging = false;
        const file = e.dataTransfer.files[0];
        if (file && this.isExcelFile(file)) {
          this.processExcelFile(file);
        }
      },

      handleDragOver(e) {
        e.preventDefault();
        this.isDragging = true;
      },

      handleDragLeave() {
        this.isDragging = false;
      },

      isExcelFile(file) {
        const acceptedTypes = ['application/vnd.ms-excel',
          'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
        return acceptedTypes.includes(file.type) ||
                ['.xls', '.xlsx'].some(ext => file.name.toLowerCase().endsWith(ext));
      },

      processExcelFile(file) {
        this.fileName = file.name;

        const reader = new FileReader();
        reader.onload = (e) => {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];

          // 转换为JSON
          const jsonData = XLSX.utils.sheet_to_json(worksheet);

          if (jsonData.length > 0) {
            // 获取表头
            this.tableHeaders = Object.keys(jsonData[0]);
            // 处理数据
            this.excelData = jsonData.map(row => {
              const newRow = {};
              Object.keys(row).forEach(key => {
                newRow[key] = row[key] !== null && row[key] !== undefined ?
                        row[key].toString() : '';
              });
              return newRow;
            });
          }
        };
        reader.readAsArrayBuffer(file);
      },

      // 数据操作
      searchData() {
        this.currentPage = 1;
      },

      changePage(page) {
        if (page >= 1 && page <= this.totalPages) {
          this.currentPage = page;
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      },

      openAddModal() {
        this.modalMode = 'add';
        this.currentRow = {};
        this.tableHeaders.forEach(header => {
          this.currentRow[header] = '';
        });
        this.showModal = true;
      },

      openEditModal(index) {
        this.modalMode = 'edit';
        this.currentIndex = index;
        this.currentRow = {...this.excelData[index]};
        this.showModal = true;
      },

      closeModal() {
        this.showModal = false;
      },

      saveRow() {
        if (this.modalMode === 'add') {
          this.excelData.push({...this.currentRow});
        } else {
          this.excelData.splice(this.currentIndex, 1, {...this.currentRow});
        }
        this.showModal = false;
      },

      deleteRow(index) {
        if (confirm('确定要删除此行数据吗？')) {
          this.excelData.splice(index, 1);
        }
      },

      exportExcel() {
        // 创建工作簿
        const workbook = XLSX.utils.book_new();

        // 准备工作表数据
        const wsData = [
          this.tableHeaders, // 表头
          ...this.excelData.map(row => this.tableHeaders.map(header => row[header]))
        ];

        // 创建工作表
        const worksheet = XLSX.utils.aoa_to_sheet(wsData);

        // 将工作表添加到工作簿
        XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");

        // 导出Excel文件
        XLSX.writeFile(workbook, `导出数据_${new Date().toLocaleDateString()}.xlsx`);
      },

      clearData() {
        if (confirm('确定要清除所有数据吗？')) {
          this.excelData = [];
          this.tableHeaders = [];
          this.fileName = '';
          this.searchTerm = '';
          this.currentPage = 1;
        }
      }
    }
  });
</script>
</body>
</html>